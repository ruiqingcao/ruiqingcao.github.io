name: Setup Ruby
on: workflow_dispatch

jobs:
  install-ruby:
    runs-on: self-hosted
    steps:
      - name: Install dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y build-essential libssl-dev zlib1g-dev libyaml-dev libreadline-dev
          sudo apt-get install -y libncurses5-dev libffi-dev libgdbm-dev

      - name: Install ruby-build
        run: |
          git clone https://github.com/rbenv/ruby-build.git
          cd ruby-build
          sudo ./install.sh

      - name: Install Ruby
        run: |
          sudo mkdir -p /opt/hostedtoolcache/Ruby/3.1.4/x64
          sudo ruby-build 3.1.4 /opt/hostedtoolcache/Ruby/3.1.4/x64
          sudo touch /opt/hostedtoolcache/Ruby/3.1.4/x64.complete

      - name: Verify installation
        run: |
          export PATH="/opt/hostedtoolcache/Ruby/3.1.4/x64/bin:$PATH"
          ruby --version
